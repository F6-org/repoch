{"version":3,"sources":["../../../../src/node_modules/@ava/babel-plugin-throws-helper/index.js"],"names":["module","exports","t","babelCore","types","wrapArg","template","helpers","assertionVisitor","CallExpression","path","state","callee","get","isMemberExpression","isIdentifier","name","assertion","node","arg0","arguments","loc","start","end","ARG","ASSERTION","stringLiteral","FILE","file","opts","filename","LINE","numericLiteral","line","installHelper","expression","visitor","Program","START","identifier","scope","generateUid","END","helperIdentifiers","created","traverse","unshiftContainer"],"mappings":"AAAA;;;;AAEAA,OAAOC,OAAP,GAAiB,qBAAa;AAC7B,KAAMC,IAAIC,UAAUC,KAApB;AACA,KAAMC,UAAUF,UAAUG,QAAV,CAAmB,gDAAnB,CAAhB;AACA,KAAMC,UAAUJ,UAAUG,QAAV,sOAAhB;;AAcA,KAAME,mBAAmB;AACxBC,gBADwB,0BACTC,IADS,EACHC,KADG,EACI;AAC3B,OAAMC,SAASF,KAAKG,GAAL,CAAS,QAAT,CAAf;AACA,OAAI,CAACD,OAAOE,kBAAP,EAAD,IAAgC,CAACF,OAAOC,GAAP,CAAW,QAAX,EAAqBE,YAArB,CAAkC,EAACC,MAAM,GAAP,EAAlC,CAAjC,IAAmF,CAACJ,OAAOC,GAAP,CAAW,UAAX,EAAuBE,YAAvB,EAAxF,EAA+H;AAC9H;AACA;;AAED,OAAME,YAAYL,OAAOC,GAAP,CAAW,UAAX,EAAuBA,GAAvB,CAA2B,MAA3B,EAAmCK,IAArD;AACA,OAAID,cAAc,QAAd,IAA0BA,cAAc,WAA5C,EAAyD;AACxD;AACA;;AAED,OAAME,OAAOT,KAAKQ,IAAL,CAAUE,SAAV,CAAoB,CAApB,CAAb;AACA,OAAI,EAAED,QAAQA,KAAKE,GAAb,IAAqB,OAAOF,KAAKG,KAAZ,KAAsB,QAA3C,IAAyD,OAAOH,KAAKI,GAAZ,KAAoB,QAA/E,CAAJ,EAA+F;AAC9F;AACA;;AAED;AACA;AACAb,QAAKQ,IAAL,CAAUE,SAAV,CAAoB,CAApB,IAAyBf,QAAQ,SAAc;AAC9CmB,SAAKL,IADyC;AAE9CM,eAAWvB,EAAEwB,aAAF,CAAgBT,SAAhB,CAFmC;AAG9CU,UAAMzB,EAAEwB,aAAF,CAAgBf,MAAMiB,IAAN,CAAWC,IAAX,CAAgBC,QAAhC,CAHwC;AAI9CC,UAAM7B,EAAE8B,cAAF,CAAiBb,KAAKE,GAAL,CAASC,KAAT,CAAeW,IAAhC;AAJwC,IAAd,EAK9B,KAAKC,aAAL,EAL8B,CAAR,EAKCC,UAL1B;AAMA;AAzBuB,EAAzB;;AA4BA,QAAO;AACNC,WAAS;AACRC,UADQ,mBACA3B,IADA,EACMC,KADN,EACa;AACpB,QAAM2B,QAAQpC,EAAEqC,UAAF,CAAa7B,KAAK8B,KAAL,CAAWC,WAAX,CAAuB,sBAAvB,CAAb,CAAd;AACA,QAAMC,MAAMxC,EAAEqC,UAAF,CAAa7B,KAAK8B,KAAL,CAAWC,WAAX,CAAuB,oBAAvB,CAAb,CAAZ;AACA,QAAME,oBAAoB,EAACL,YAAD,EAAQI,QAAR,EAA1B;;AAEA,QAAIE,UAAU,KAAd;AACAlC,SAAKmC,QAAL,CAAcrC,gBAAd,EAAgC;AAC/B0B,kBAD+B,2BACf;AACf,UAAI,CAACU,OAAL,EAAc;AACbA,iBAAU,IAAV;AACAlC,YAAKoC,gBAAL,CAAsB,MAAtB,EAA8BvC,QAAQoC,iBAAR,CAA9B;AACA;;AAED,aAAOA,iBAAP;AACA,MAR8B;;AAS/Bf,WAAMjB,MAAMiB;AATmB,KAAhC;AAWA;AAlBO;AADH,EAAP;AAsBA,CAnED","file":"index.js","sourcesContent":["'use strict';\n\nmodule.exports = babelCore => {\n\tconst t = babelCore.types;\n\tconst wrapArg = babelCore.template('(START(t, ASSERTION, FILE, LINE), END(t, ARG))');\n\tconst helpers = babelCore.template(`function START(t, assertion, file, line) {\n  if (t._throwsArgStart) {\n    t._throwsArgStart(assertion, file, line);\n  }\n}\n\nfunction END(t, arg) {\n  if (t._throwsArgEnd) {\n    t._throwsArgEnd();\n  }\n\n  return arg;\n}`);\n\n\tconst assertionVisitor = {\n\t\tCallExpression(path, state) {\n\t\t\tconst callee = path.get('callee');\n\t\t\tif (!callee.isMemberExpression() || !callee.get('object').isIdentifier({name: 't'}) || !callee.get('property').isIdentifier()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst assertion = callee.get('property').get('name').node;\n\t\t\tif (assertion !== 'throws' && assertion !== 'notThrows') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst arg0 = path.node.arguments[0];\n\t\t\tif (!(arg0 && arg0.loc && (typeof arg0.start === 'number') && (typeof arg0.end === 'number'))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Wrap the argument expression, so that the stack trace of the assertion\n\t\t\t// isn't affected.\n\t\t\tpath.node.arguments[0] = wrapArg(Object.assign({\n\t\t\t\tARG: arg0,\n\t\t\t\tASSERTION: t.stringLiteral(assertion),\n\t\t\t\tFILE: t.stringLiteral(state.file.opts.filename),\n\t\t\t\tLINE: t.numericLiteral(arg0.loc.start.line)\n\t\t\t}, this.installHelper())).expression;\n\t\t}\n\t};\n\n\treturn {\n\t\tvisitor: {\n\t\t\tProgram(path, state) {\n\t\t\t\tconst START = t.identifier(path.scope.generateUid('avaThrowsHelperStart'));\n\t\t\t\tconst END = t.identifier(path.scope.generateUid('avaThrowsHelperEnd'));\n\t\t\t\tconst helperIdentifiers = {START, END};\n\n\t\t\t\tlet created = false;\n\t\t\t\tpath.traverse(assertionVisitor, {\n\t\t\t\t\tinstallHelper() {\n\t\t\t\t\t\tif (!created) {\n\t\t\t\t\t\t\tcreated = true;\n\t\t\t\t\t\t\tpath.unshiftContainer('body', helpers(helperIdentifiers));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn helperIdentifiers;\n\t\t\t\t\t},\n\t\t\t\t\tfile: state.file\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n};\n"]}