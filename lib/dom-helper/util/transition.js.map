{"version":3,"sources":["../../../src/dom-helper/util/transition.js"],"names":["listenTransition","listenAnimationIteration","listenAnimationEnd","dummyStyle","process","env","BROWSER","document","createElement","style","vendor","vendors","split","t","i","l","length","substr","prefixStyle","charAt","toUpperCase","transitionEndEvent","toLowerCase","transition","target","duration","callbackFn","me","clear","transitionTimer","clearTimeout","removeEventListener","handler","call","addEventListener","setTimeout"],"mappings":"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","file":"transition.js","sourcesContent":["/**\n * 监听transitionEnd\n * \n * @author MrGalaxyn@staff.sina.com.cn\n */\nlet dummyStyle = process.env.BROWSER ? document.createElement('div').style : {};\nlet vendor = (function () {\n    let vendors = 't,webkitT,MozT,msT,OT'.split(','),\n        t,\n        i = 0,\n        l = vendors.length;\n\n    for (; i < l; i++) {\n        t = vendors[i] + 'ransform';\n        if (t in dummyStyle) {\n            return vendors[i].substr(0, vendors[i].length - 1);\n        }\n    }\n\n    return false;\n}());\n\nlet prefixStyle = function(style) {\n    if (vendor === '') return style;\n    style = style.charAt(0).toUpperCase() + style.substr(1);\n    return vendor + style;\n};\n\nlet transitionEndEvent = (function() {\n    if (vendor == 'webkit' || vendor === 'O') {\n        return vendor.toLowerCase() + 'TransitionEnd';\n    }\n    return 'transitionend';\n}());\n\nexport const transition = prefixStyle('transition');\n\nexport function listenTransition(target, duration, callbackFn) {\n    var me = this,\n        clear = function() {\n            if (target.transitionTimer) clearTimeout(target.transitionTimer);\n            target.transitionTimer = null;\n            target.removeEventListener(transitionEndEvent, handler, false);\n        },\n        handler = function() {\n            clear();\n            if (callbackFn) callbackFn.call(me);\n        };\n    clear();\n    target.addEventListener(transitionEndEvent, handler, false);\n    target.transitionTimer = setTimeout(handler, duration + 100);\n};\n\nexport function listenAnimationIteration(target, duration, callbackFn) {\n    var me = this, transitionTimer,\n        // event = transitionEndEvent === 'transitionend' ? 'animationiteration' :\n        //     transitionEndEvent.replace('TransitionEnd', 'AnimationIteration'),\n        clear = function() {\n            if (transitionTimer) clearTimeout(transitionTimer);\n            transitionTimer = null;\n            // target.removeEventListener(event, handler, false);\n            target.removeEventListener('animationiteration', handler, false);\n            target.removeEventListener('webkitAnimationIteration', handler, false);\n        },\n        handler = function() {\n            clear();\n            if (callbackFn) callbackFn.call(me);\n        };\n    clear();\n    target.addEventListener('animationiteration', handler, false);\n    target.addEventListener('webkitAnimationIteration', handler, false);\n    // target.addEventListener(event, handler, false);\n    transitionTimer = setTimeout(handler, duration + 100);\n};\n\nexport function listenAnimationEnd(target, duration, callbackFn) {\n    var me = this, transitionTimer,\n        // event = transitionEndEvent === 'transitionend' ? 'animationend' :\n        //     transitionEndEvent.replace('TransitionEnd', 'AnimationEnd'),\n        clear = function() {\n            if (transitionTimer) clearTimeout(transitionTimer);\n            transitionTimer = null;\n            // target.removeEventListener(event, handler, false);\n            target.removeEventListener('animationend', handler, false);\n            target.removeEventListener('webkitAnimationEnd', handler, false);\n        },\n        handler = function() {\n            clear();\n            if (callbackFn) callbackFn.call(me);\n        };\n    clear();\n    target.addEventListener('animationend', handler, false);\n    target.addEventListener('webkitAnimationEnd', handler, false);\n    transitionTimer = setTimeout(handler, duration + 100);\n};\n\n"]}