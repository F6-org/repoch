{"version":3,"sources":["../../../src/dom-helper/util/iframe.js"],"names":["setInnerIframe","iframeConnect","FrameInner","tmpDiv","timer","timerSet","bodyWidth","bodyHeight","_radom","Date","getTime","_this","autoHlayer","login","trigger","scroll","scrollFn","on","getOuterInfo","getLayoutInfo","info","outInfo","setIframeHeight","size","setHeight","setDiaAutoHeight","diaAutoHeight","el","push","setTimeout","_pageH","t","height","page","_addH","document","body","addAutoDiv","createElement","appendChild","_div","_divHeight","_h","style","display","hidediaAutoHeight","diaAutoHide","getIframeSize","_size","width","_tmpTop","childNodes","length","rect","getBoundingClientRect","parseInt","top","getAttribute","setAttribute","id","visibility","window","iframeSize","clearInterval","setInterval"],"mappings":"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","file":"iframe.js","sourcesContent":["import './iconnect';\nimport isNode from '../dom/is-node';\nimport getSize from '../dom/get-size';\nimport position from '../dom/position';\nimport pageSize from './page-size';\n\n//变量定义区\nvar iframeConnect = {};\nvar FrameInner = {};\nvar tmpDiv = null;\nvar timer, timerSet;\nvar bodyWidth;\nvar bodyHeight;\nvar _radom = 'T' + new Date().getTime();\nvar _this = {\n    autoHlayer: [],\n    // reDefineScrollto : function(){\n    //     $.core.util.scrollTo = function(el,opts){\n    //         var _top = (opts && opts.top)?opts.top:0;\n    //         var elTop = $.core.dom.position(el).t;\n    //         _top = (elTop || 0) - _top;\n    //         var _moveStop = (opts && opts.onMoveStop) || $.core.func.empty();\n    //         iframeConnect.trigger &&iframeConnect.trigger('scrollTo', _top, _moveStop);\n    //     };\n    // },\n    login: function(){\n        iframeConnect.trigger('uiLogin');\n    },\n    scroll: function(scrollFn){\n        iframeConnect.on('scroll', scrollFn);\n    },\n    getOuterInfo : function(){\n        iframeConnect.getLayoutInfo(function(info){\n            FrameInner.outInfo = info;\n        });\n        return true;\n    },\n    setIframeHeight : function(size){\n        iframeConnect.setHeight(size);\n    },\n    setDiaAutoHeight : function(){\n        FrameInner.diaAutoHeight = function(el){\n            _this.autoHlayer.push(el);\n            //at 绑定了 document.body 添加延时\n            setTimeout(function(){\n                var _pageH;\n                if(isNode(el)){\n                    _pageH = position(el).t + getSize(el).height;\n                }else{\n                    //chrome时 util.pageSize().page.hegith 不包含在iframe中\n                    _pageH = pageSize().page.height;\n                }\n                var _addH = _pageH - getSize(document.body).height;\n                if(_addH > 0){\n                    if(!FrameInner.addAutoDiv){\n                        FrameInner.addAutoDiv = document.createElement('div');\n                        document.body.appendChild(FrameInner.addAutoDiv);\n                    }\n                    var _div = FrameInner.addAutoDiv;\n                    var _divHeight = getSize(_div).height\n                    var _h = (_div && _div.style.display != 'none')?_divHeight:0;\n                    _div.style.display = '';\n                    _div.style.height = (_addH + _h) + 'px';\n                }\n            },100);\n        }\n    },\n    hidediaAutoHeight : function(){\n        FrameInner.diaAutoHide = function(){\n            /*var isShowing = false;\n            console.log(_this.autoHlayer);\n            $.foreach(_this.autoHlayer,function(o,i){\n                if(o && (o.style.display != 'none')){\n                    isShowing = true;\n                }else{\n                    _this.autoHlayer.splice(i,1);\n                }\n            });\n            console.log(11, isShowing);\n            if(isShowing){return;}*/\n            FrameInner.addAutoDiv && (FrameInner.addAutoDiv.style.display = 'none');\n        }\n    },\n    //获取iframe尺寸\n    getIframeSize : function(){\n        var _size = pageSize().page;\n        var width = _size.width;\n        var height = _size.height;\n        var _tmpTop;\n        if(tmpDiv){\n            var childNodes = document.body.childNodes;\n            if(childNodes[childNodes.length - 1] !== tmpDiv){\n                document.body.appendChild(tmpDiv);\n            }\n            var rect = tmpDiv.getBoundingClientRect();\n            _tmpTop = parseInt(rect.top + 10);\n            if(_tmpTop !== parseInt(tmpDiv.getAttribute(\"_top\"))){\n                height = _tmpTop;\n                // console.log(height, _tmpTop, width == bodyWidth && height == bodyHeight);\n                tmpDiv.setAttribute(\"_top\", height);\n            }\n        }\n        if(width == bodyWidth && height == bodyHeight){\n            return height;\n        }\n        bodyWidth = width;\n        bodyHeight = height;\n        if(!tmpDiv){\n            tmpDiv = document.createElement(\"div\");\n            tmpDiv.id = \"ifr_footer\";\n            tmpDiv.style.visibility = \"hidden\";\n            tmpDiv.style.height = \"0px\";\n            document.body.appendChild(tmpDiv);\n            _tmpTop = tmpDiv.getBoundingClientRect().top + 10;\n            tmpDiv.setAttribute(\"_top\", _tmpTop);\n            bodyHeight = _tmpTop;\n        }\n        return bodyHeight;\n    }\n};\nexport function setInnerIframe() {\n        iframeConnect = window.iframeConnect();\n        iframeConnect.login = _this.login;\n        iframeConnect.scroll = _this.scroll;\n        //设置iframe高度\n        var iframeSize;\n        clearInterval(timerSet);\n        timerSet = setInterval(function(){\n            iframeSize = _this.getIframeSize();\n            _this.setIframeHeight(iframeSize);\n        }, 500);\n        //抛出自动调整高度方法\n        _this.setDiaAutoHeight();\n        _this.hidediaAutoHeight();\n        //重新定义scrollto方法\n        // _this.reDefineScrollto();\n        //$.core.util.scrollTo(document.body, {top:200});\n        //设置为全局\n        window.FrameInner = FrameInner;\n        //获取外层全局信息\n        clearInterval(timer);\n        timer = setInterval(_this.getOuterInfo, 500);\n};\n"]}