{"version":3,"sources":["../../src/navigation/index.js"],"names":["scheme","schemekk","schemeclose","weiboShare","navigationCloseAndOpen","historyBackAddUrl","historyBackAddUrlWhen","generateUrl","openUserProfile","openClient","url","encodeURIComponent","content","pics","picList","concat","map","thumbnail","fid","original","pid","window","location","href","decodeURIComponent","length","JSON","stringify","addUrl","curUrl","history","pushState","replaceState","onpopstate","e","state","replace","judgement","addition","reserve","searchString","search","query","target","split","addQuery","substr","Object","keys","k","join","string","filter","item","key","value","indexOf","uid","console","warn","test","navigator","userAgent"],"mappings":"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","file":"index.js","sourcesContent":["/*\n * scheme url operation\n * author: Fuyu@lonefy\n * create time: 2018-05-24\n * \n */\nimport Image from \"../weibo-image\";\n\nexport function scheme(url) {\n    return \"sinaweibo://browser?url=\" + encodeURIComponent(url);\n}\n\nexport function schemekk(url) {\n    return \"sinaweibo://kk?url=\" + encodeURIComponent(url);\n}\n\nexport function schemeclose(url){\n    return \"sinaweibo://browser/close?scheme=\" + encodeURIComponent(url)\n}\n\nexport function weiboShare(content, pics = []) {\n    let picList = [].concat(pics).map(fid => {\n        return {\n            thumbnail: \"https:\" + Image(fid, \"thumbnail\"),\n            original: \"https:\" + Image(fid, \"large\"),\n            pid: fid\n        };\n    });\n    window.location.href =\n        \"sinaweibo://sendweibo?content=\" +\n        encodeURIComponent(decodeURIComponent(content)) +\n        (picList.length\n            ? \"&pics=\" + encodeURIComponent(JSON.stringify(picList))\n            : \"\");\n}\n\nexport function navigationCloseAndOpen(url) {\n    window.location.href =\n        \"sinaweibo://browser/close?scheme=\" + encodeURIComponent(url);\n}\n\nexport function historyBackAddUrl(addUrl, curUrl = window.location.href) {\n    const { history } = window;\n    if (history.pushState && history.length <= 1) {\n        history.replaceState(\"curstate\", null, curUrl);\n        history.pushState({}, null, curUrl);\n    }\n    window.onpopstate = e => {\n        if (e.state == \"curstate\") {\n            window.location.replace(addUrl);\n        }\n    };\n}\n\nexport function historyBackAddUrlWhen(addUrl, judgement = (window.history.length <= 1)) {\n    const { history, location } = window;\n    const curUrl = location.href;\n    if (history.pushState && judgement) {\n        history.replaceState(\"newstate\", null, curUrl);\n        history.pushState({}, null, curUrl);\n    }\n    window.onpopstate = e => {\n        if (e.state == \"newstate\") {\n            location.replace(addUrl);\n        }\n    };\n}\n\n/*\n * 生成目标页地址\n * 用于保留当前页面url query\n * \n * @params url[string] 目标页url\n * @params addition[object] 增加字段\n * @params reserve[string/array] 保留query\n * \n * @return url[string]\n */\nexport function generateUrl(url = \"\", addition = {}, reserve = []) {\n    var searchString = window.location.search,\n        query = {},\n        target = url.split(\"?\"),\n        reserve = [].concat(reserve)\n\n    addQuery(searchString.substr(1, searchString.length))\n\n    target[1] && addQuery(target[1], false)\n\n    addition = Object.assign(addition, query)\n\n    return target[0] + \"?\" + Object.keys(addition).map(k => `${k}=${addition[k]}`).join(\"&\");\n\n    function addQuery(string, filter = true) {\n        string.split(\"&\").map(item => {\n            var [key, value] = item.split(\"=\");\n\n            if(filter){\n                if (reserve.indexOf(key) !== -1) {\n                    query[key] = value;\n                }\n            }else{\n                query[key] = value;\n            }\n\n        });\n    }\n}\n/*\n * 打开用户profile页 \n * @params uid\n * \n */\nexport function openUserProfile(uid){\n    if(!uid){\n        console.warn('no Params: uid');\n        return\n    }\n    let url = `http://weibo.com/${uid}/profile`\n\n    if(/__weibo__/.test(window.navigator.userAgent)){\n        url = `sinaweibo://userinfo?uid=${uid}`\n    }\n    window.location.href = url\n}\n\n/*\n * 端外呼起客户端 \n * @params url\n * \n */\nexport function openClient(url){\n    window.location.href = [\n        'https://m.weibo.cn/feature/openapp?scheme=',\n        encodeURIComponent([\n            'sinaweibo://browser?url=',\n            encodeURIComponent(url)\n        ].join('')),\n        '&yingyongbao=1&url=',\n        encodeURIComponent(url)\n    ].join('');\n}"]}