{"version":3,"sources":["../../../../src/ajax/lib/adapters/http.js"],"names":["httpAdapter","config","Promise","dispatchHttpRequest","resolve","reject","data","headers","timer","aborted","utils","isStream","isArrayBuffer","Buffer","Uint8Array","isString","length","auth","undefined","username","password","parsed","url","parse","protocol","urlAuth","split","urlUsername","urlPassword","Authorization","isHttps","agent","httpsAgent","httpAgent","options","hostname","port","path","params","paramsSerializer","replace","method","proxy","proxyEnv","slice","proxyUrl","process","env","toUpperCase","parsedProxyUrl","host","proxyUrlAuth","base64","toString","transport","maxRedirects","https","http","httpsFollow","httpFollow","req","request","handleResponse","res","clearTimeout","stream","pipe","zlib","createUnzip","response","status","statusCode","statusText","statusMessage","responseType","responseBuffer","on","handleStreamData","chunk","push","maxContentLength","concat","handleStreamError","err","handleStreamEnd","responseData","handleRequestError","timeout","setTimeout","handleRequestTimeout","abort","cancelToken","promise","then","onCanceled","cancel","end"],"mappings":"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","file":"http.js","sourcesContent":["'use strict';\n\nimport utils from './../utils';\nimport settle from './../core/settle';\nimport buildURL from './../helpers/buildURL';\nimport http from 'http';\nimport https from 'https';\nimport { httpFollow, httpsFollow } from 'follow-redirects';\nimport url from 'url';\nimport zlib from 'zlib';\nimport { Buffer } from 'buffer';\nimport createError from '../core/createError';\nimport enhanceError from '../core/enhanceError';\n\n/*eslint consistent-return:0*/\nexport default function httpAdapter(config) {\n  return new Promise(function dispatchHttpRequest(resolve, reject) {\n    var data = config.data;\n    var headers = config.headers;\n    var timer;\n    var aborted = false;\n\n    // Set User-Agent (required by some servers)\n    // Only set header if it hasn't been set in config\n    // See https://github.com/mzabriskie/axios/issues/69\n    if (!headers['User-Agent'] && !headers['user-agent']) {\n      headers['User-Agent'] = 'axios/' + '0.15.3';\n    }\n\n    if (data && !utils.isStream(data)) {\n      if (utils.isArrayBuffer(data)) {\n        data = new Buffer(new Uint8Array(data));\n      } else if (utils.isString(data)) {\n        data = new Buffer(data, 'utf-8');\n      } else {\n        return reject(createError(\n          'Data after transformation must be a string, an ArrayBuffer, or a Stream',\n          config\n        ));\n      }\n\n      // Add Content-Length header if data exists\n      headers['Content-Length'] = data.length;\n    }\n\n    // HTTP basic authentication\n    var auth = undefined;\n    if (config.auth) {\n      var username = config.auth.username || '';\n      var password = config.auth.password || '';\n      auth = username + ':' + password;\n    }\n\n    // Parse url\n    var parsed = url.parse(config.url);\n    var protocol = parsed.protocol || 'http:';\n\n    if (!auth && parsed.auth) {\n      var urlAuth = parsed.auth.split(':');\n      var urlUsername = urlAuth[0] || '';\n      var urlPassword = urlAuth[1] || '';\n      auth = urlUsername + ':' + urlPassword;\n    }\n\n    if (auth) {\n      delete headers.Authorization;\n    }\n\n    var isHttps = protocol === 'https:';\n    var agent = isHttps ? config.httpsAgent : config.httpAgent;\n\n    var options = {\n      hostname: parsed.hostname,\n      port: parsed.port,\n      path: buildURL(parsed.path, config.params, config.paramsSerializer).replace(/^\\?/, ''),\n      method: config.method,\n      headers: headers,\n      agent: agent,\n      auth: auth\n    };\n\n    var proxy = config.proxy;\n    if (!proxy) {\n      var proxyEnv = protocol.slice(0, -1) + '_proxy';\n      var proxyUrl = process.env[proxyEnv] || process.env[proxyEnv.toUpperCase()];\n      if (proxyUrl) {\n        var parsedProxyUrl = url.parse(proxyUrl);\n        proxy = {\n          host: parsedProxyUrl.hostname,\n          port: parsedProxyUrl.port\n        };\n\n        if (parsedProxyUrl.auth) {\n          var proxyUrlAuth = parsedProxyUrl.auth.split(':');\n          proxy.auth = {\n            username: proxyUrlAuth[0],\n            password: proxyUrlAuth[1]\n          };\n        }\n      }\n    }\n\n    if (proxy) {\n      options.hostname = proxy.host;\n      options.host = proxy.host;\n      options.headers.host = parsed.hostname + (parsed.port ? ':' + parsed.port : '');\n      options.port = proxy.port;\n      options.path = protocol + '//' + parsed.hostname + (parsed.port ? ':' + parsed.port : '') + options.path;\n\n      // Basic proxy authorization\n      if (proxy.auth) {\n        var base64 = new Buffer(proxy.auth.username + ':' + proxy.auth.password, 'utf8').toString('base64');\n        options.headers['Proxy-Authorization'] = 'Basic ' + base64;\n      }\n    }\n\n    var transport;\n    if (config.maxRedirects === 0) {\n      transport = isHttps ? https : http;\n    } else {\n      if (config.maxRedirects) {\n        options.maxRedirects = config.maxRedirects;\n      }\n      transport = isHttps ? httpsFollow : httpFollow;\n    }\n\n    // Create the request\n    var req = transport.request(options, function handleResponse(res) {\n      if (aborted) return;\n\n      // Response has been received so kill timer that handles request timeout\n      clearTimeout(timer);\n      timer = null;\n\n      // uncompress the response body transparently if required\n      var stream = res;\n      switch (res.headers['content-encoding']) {\n      /*eslint default-case:0*/\n      case 'gzip':\n      case 'compress':\n      case 'deflate':\n        // add the unzipper to the body stream processing pipeline\n        stream = stream.pipe(zlib.createUnzip());\n\n        // remove the content-encoding in order to not confuse downstream operations\n        delete res.headers['content-encoding'];\n        break;\n      }\n\n      var response = {\n        status: res.statusCode,\n        statusText: res.statusMessage,\n        headers: res.headers,\n        config: config,\n        request: req\n      };\n\n      if (config.responseType === 'stream') {\n        response.data = stream;\n        settle(resolve, reject, response);\n      } else {\n        var responseBuffer = [];\n        stream.on('data', function handleStreamData(chunk) {\n          responseBuffer.push(chunk);\n\n          // make sure the content length is not over the maxContentLength if specified\n          if (config.maxContentLength > -1 && Buffer.concat(responseBuffer).length > config.maxContentLength) {\n            reject(createError('maxContentLength size of ' + config.maxContentLength + ' exceeded', config));\n          }\n        });\n\n        stream.on('error', function handleStreamError(err) {\n          if (aborted) return;\n          reject(enhanceError(err, config));\n        });\n\n        stream.on('end', function handleStreamEnd() {\n          var responseData = Buffer.concat(responseBuffer);\n          if (config.responseType !== 'arraybuffer') {\n            responseData = responseData.toString('utf8');\n          }\n\n          response.data = responseData;\n          settle(resolve, reject, response);\n        });\n      }\n    });\n\n    // Handle errors\n    req.on('error', function handleRequestError(err) {\n      if (aborted) return;\n      reject(enhanceError(err, config));\n    });\n\n    // Handle request timeout\n    if (config.timeout && !timer) {\n      timer = setTimeout(function handleRequestTimeout() {\n        req.abort();\n        reject(createError('timeout of ' + config.timeout + 'ms exceeded', config, 'ECONNABORTED'));\n        aborted = true;\n      }, config.timeout);\n    }\n\n    if (config.cancelToken) {\n      // Handle cancellation\n      config.cancelToken.promise.then(function onCanceled(cancel) {\n        if (aborted) {\n          return;\n        }\n\n        req.abort();\n        reject(cancel);\n        aborted = true;\n      });\n    }\n\n    // Send the request\n    if (utils.isStream(data)) {\n      data.pipe(req);\n    } else {\n      req.end(data);\n    }\n  });\n};\n"]}