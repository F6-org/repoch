{"version":3,"sources":["../../src/listview/index.js"],"names":["SCROLLER_CHECK_DURATION","TOUCHMOVE_CHECK_DURATION","PULL_MAX_DURATION","PULLED_DOWN","STATUS_DEFAULT","STATUS_PREPARE","STATUS_LOAD","ListView","componentDidMount","_hasMounted","_draggable","_canTouchMove","scrollCheckTimer","touchMoveTriggerTimer","wrapper","ReactDOM","findDOMNode","refs","scroller","list","createPullUpRegion","document","body","addEventListener","handleDocumentTouchMove","handleTouchStart","handleTouchMove","handleTouchEnd","handleScroll","componentDidUpdate","componentWillUnmount","removeEventListener","createPullDownRegion","removePullDownRegion","header","createElement","className","_touchCoords","status","processLoaderStatus","insertBefore","removeChild","footer","appendChild","clientHeight","offsetHeight","props","showNoContent","disablePullUp","innerHTML","content","style","height","threshold","handleLoaderStatusChange","helper","onLoaderStatusChange","call","orient","offsetY","currentStatus","moved","overflow","nextStatus","onPullDown","reset","agent","navigator","userAgent","toLowerCase","indexOf","pullDown","e","isScroller","cancelable","preventDefault","startScrollY","scrollTop","isPullDownDisabled","isPullUpDisabled","point","touches","_pointX","pageX","_pointY","pageY","_startMove","startY","screenY","clearTimeout","compatSlider","deltaX","deltaY","Math","abs","coords","blockY","stopY","overY","canPullDown","setTimeout","doTransition","checkScrollEnd","node","scrollHeight","pullUpThreshold","onPullUp","bind","target","handleTransitionEnd","targetHeight","adjustHeight","duration","ceil","endHandler","transition","disabled","id","wrapperClassName","scrollerClassName","children","React","Component","propTypes","PropTypes","number","oneOfType","bool","func","string","defaultProps","scrollTo","getElementById"],"mappings":"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","file":"index.js","sourcesContent":["import PropTypes from 'prop-types';\r\n/* eslint-env browser */\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { transition, listenTransition } from '../dom-helper/util/transition';\r\n\r\nimport './listview.css';\r\n// import withStyles from '@repoch/with-styles';\r\n\r\nconst SCROLLER_CHECK_DURATION = 50;\r\nconst TOUCHMOVE_CHECK_DURATION = 500;\r\nconst PULL_MAX_DURATION = 200;\r\nconst PULLED_DOWN = 1;\r\nconst STATUS_DEFAULT = 11;\r\nconst STATUS_PREPARE = 12;\r\nconst STATUS_LOAD = 13;\r\n\r\nexport default class ListView extends React.Component {\r\n    static propTypes = {\r\n        threshold: PropTypes.number, // 拖拽阈值\r\n        pullUpThreshold: PropTypes.number, // 上拉补偿值\r\n        onLoaderStatusChange: PropTypes.oneOfType([\r\n            PropTypes.bool,\r\n            PropTypes.func\r\n        ]), // 下拉样式处理函数\r\n        showNoContent: PropTypes.bool,\r\n        isPullDownDisabled: PropTypes.bool, //是否禁止下拉刷新功能，默认false不禁止\r\n        content: PropTypes.string,\r\n        wrapperClassName: PropTypes.string,\r\n        scrollerClassName: PropTypes.string,\r\n        compatSlider: PropTypes.bool,\r\n        id: PropTypes.string,\r\n        onPullDown: PropTypes.func, // 刷新事件\r\n        onPullUp: PropTypes.func // 加载事件\r\n    };\r\n\r\n    static defaultProps = {\r\n        threshold: 40,\r\n        pullUpThreshold: 40,\r\n        onLoaderStatusChange: false,\r\n        isPullDownDisabled: false,\r\n        wrapperClassName: '' || 'component_wrapper_list',\r\n        scrollerClassName: '' || 'component_scroller_list',\r\n        showNoContent: false,\r\n        compatSlider: false,\r\n        id: 'listview',\r\n        onPullDown: function() {},\r\n        onPullUp: function() {}\r\n    };\r\n    // 禁止下拉刷新\r\n    // isPullDownDisabled = true;\r\n\r\n    componentDidMount = () => {\r\n        this._hasMounted = true;\r\n        this._draggable = true;\r\n        this._canTouchMove = false;\r\n\r\n        this.scrollCheckTimer = null;\r\n        this.touchMoveTriggerTimer = null;\r\n\r\n        this.wrapper = ReactDOM.findDOMNode(this.refs.wrapper);\r\n        this.scroller = ReactDOM.findDOMNode(this.refs.list);\r\n        this.createPullUpRegion();\r\n\r\n        // 使用真实的时间，阻止ios页面bounce效果\r\n        document.body.addEventListener('touchmove', this.handleDocumentTouchMove);\r\n\r\n        this.wrapper.addEventListener('touchstart', this.handleTouchStart);\r\n        this.wrapper.addEventListener('touchmove', this.handleTouchMove);\r\n        this.wrapper.addEventListener('touchend', this.handleTouchEnd);\r\n        this.wrapper.addEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    componentDidUpdate = () => {\r\n        this.createPullUpRegion();\r\n    }\r\n\r\n    componentWillUnmount = () => {\r\n        this._hasMounted = false;\r\n        // 使用真实的时间，阻止ios页面bounce效果\r\n        document.body.removeEventListener('touchmove', this.handleDocumentTouchMove);\r\n\r\n        this.wrapper.removeEventListener('touchstart', this.handleTouchStart);\r\n        this.wrapper.removeEventListener('touchmove', this.handleTouchMove);\r\n        this.wrapper.removeEventListener('touchend', this.handleTouchEnd);\r\n        this.wrapper.removeEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    createPullDownRegion = () => {\r\n        this.removePullDownRegion();\r\n        this.header = document.createElement('div');\r\n        this.header.className = 'latest';\r\n        this._touchCoords.status = this.processLoaderStatus(PULLED_DOWN, 0, null, true);\r\n        this.wrapper.insertBefore(this.header, this.scroller);\r\n        return this.header;\r\n    }\r\n\r\n    removePullDownRegion = () => {\r\n        if (this.header) {\r\n            this.wrapper.removeChild(this.header);\r\n            this.header = null;\r\n        }\r\n    }\r\n\r\n    createPullUpRegion = () => {\r\n        if (!this.footer) {\r\n            this.footer = document.createElement('div');\r\n            this.wrapper.appendChild(this.footer);\r\n        }\r\n        if (this.wrapper.clientHeight >= this.scroller.offsetHeight ||\r\n            this.props.showNoContent\r\n        ) {\r\n        // if (\r\n        //     this.props.showNoContent\r\n        // ) {\r\n            this.disablePullUp(true);\r\n            this.footer.className = 'loader';\r\n            this.footer.innerHTML = `<p class='non_cont'>${this.props.content}</p>`;\r\n            this.footer.style.height = this.props.threshold * 1.25 * 2 * 0.01 + 'rem';\r\n        } else {\r\n            this.disablePullUp(false);\r\n            this.footer.className = 'loader';\r\n            this.footer.innerHTML = '' +\r\n                '<div class=' + \"loader\" + '>' +\r\n                    '<em class=' + \"pull-loading\" + '></em>' +\r\n                    '<span>加载中...</span>' +\r\n                '</div>';\r\n            this.footer.style.height = this.props.threshold * 2 * 0.01 + 'rem';\r\n        }\r\n    }\r\n\r\n    handleLoaderStatusChange = status => {\r\n        let helper = this.props.onLoaderStatusChange || function(status) {\r\n            if (status === STATUS_DEFAULT) {\r\n                return '<div class=\"' + \"loader\" + '\">' +\r\n                  '<em class=\"' + \"pull-down\" + '\"></em>' +\r\n                  '<span>下拉刷新</span>' +\r\n                '</div>';\r\n            } else if (status === STATUS_PREPARE) {\r\n                return '<div class=\"' + \"loader\" + '\"\">' +\r\n                  '<em class=\"' + \"pull-up\" + '\"></em>' +\r\n                  '<span>释放更新</span>' +\r\n            '</div>';\r\n            } else if (status === STATUS_LOAD) {\r\n                return '<div class=\"' + \"loader\" + '\">'+\r\n                  '<em class=\"' + \"pull-loading\" + '\"></em>'+\r\n                  '<span>加载中...</span>'+\r\n                '</div>';\r\n            }\r\n        };\r\n\r\n        if (this.header && helper && typeof helper === 'function') {\r\n            this.header.innerHTML = helper.call(this, status);\r\n        }\r\n    }\r\n\r\n    processLoaderStatus = (orient, offsetY, currentStatus, moved) => {\r\n        let overflow, nextStatus = currentStatus;\r\n        if (orient === PULLED_DOWN) {\r\n            overflow = offsetY > this.props.threshold * 2;\r\n            if (!overflow && currentStatus !== STATUS_DEFAULT) {\r\n                this.handleLoaderStatusChange(STATUS_DEFAULT);\r\n                nextStatus = STATUS_DEFAULT;\r\n            } else if (moved && overflow && currentStatus !== STATUS_PREPARE) {\r\n                this.handleLoaderStatusChange(STATUS_PREPARE);\r\n                nextStatus = STATUS_PREPARE;\r\n            } else if (!moved && overflow && currentStatus !== STATUS_LOAD) {\r\n                this.handleLoaderStatusChange(STATUS_LOAD);\r\n                this.props.onPullDown(this.reset);\r\n                nextStatus = STATUS_LOAD;\r\n            }\r\n        }\r\n\r\n        return nextStatus;\r\n    }\r\n\r\n    handleDocumentTouchMove = e => {\r\n        let agent = navigator.userAgent.toLowerCase();\r\n        if ((agent.indexOf(\"iphone\") >= 0 || agent.indexOf(\"ipad\") >= 0) &&\r\n            (this._touchCoords && this._touchCoords.pullDown) && e.isScroller) {\r\n            // e.preventDefault();\r\n            if (e.cancelable) {\r\n                // 判断默认行为是否已经被禁用\r\n                if (!e.preventDefault) {\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    handleTouchStart = e => {\r\n        this._canTouchMove = false;\r\n        let startScrollY =  this.wrapper.scrollTop;\r\n\r\n        if (this._draggable && \r\n                (this.props.isPullDownDisabled !== true || \r\n                    this.isPullUpDisabled !== true)\r\n        ) {\r\n            this._draggable = false;\r\n            this._canTouchMove = true;\r\n\r\n            let point = e.touches && e.touches[0];\r\n\r\n            this._pointX = point.pageX;\r\n            this._pointY = point.pageY;\r\n            this._startMove = true;\r\n\r\n            this._touchCoords = {};\r\n            this._touchCoords.startY = e.touches[0].screenY;\r\n            this._touchCoords.startScrollY = startScrollY;\r\n        }\r\n    }\r\n\r\n    handleTouchMove = e => {\r\n        e.isScroller = true;\r\n        this.touchMoveTriggerTimer && clearTimeout(this.touchMoveTriggerTimer);\r\n\r\n        if (this._canTouchMove && this.props.compatSlider && this._startMove) {\r\n            let point = e.touches && e.touches[0];\r\n            let deltaX = point.pageX - this._pointX;\r\n            let deltaY = point.pageY - this._pointY;\r\n\r\n            this._startMove = false;\r\n            this._canTouchMove = Math.abs(deltaX) > Math.abs(deltaY) ? false : true;\r\n            this._draggable = !this._canTouchMove;\r\n        }\r\n\r\n        if (!this._canTouchMove) return;\r\n        // e.stopPropagation();\r\n\r\n        let coords = this._touchCoords;\r\n        let startScrollY = coords.startScrollY;\r\n        let blockY = coords.blockY;\r\n        let startY = coords.startY;\r\n        let stopY = e.touches[0].screenY;\r\n        let offsetY, overY;\r\n\r\n        if (typeof coords.canPullDown === 'undefined') {\r\n            coords.canPullDown = this.props.isPullDownDisabled !== true && \r\n                    startY < stopY && startScrollY <= 0;\r\n        }\r\n        if (coords.canPullDown && (coords.pullDown || startY - stopY + startScrollY < 0)) {\r\n            // e.preventDefault(); 新版chrome对这块有处理\r\n            coords.pullDown = true;\r\n            if (!this.header) {\r\n                this.header = this.createPullDownRegion();\r\n            }\r\n            if (typeof blockY === 'undefined') {\r\n                coords.blockY = blockY = stopY;\r\n            }\r\n            offsetY = stopY - blockY;\r\n            offsetY = offsetY > 0 ? offsetY : 0;\r\n\r\n            // 阻尼\r\n            let threshold = this.props.threshold;\r\n            overY = offsetY - threshold;\r\n            if (overY > 100) {\r\n                offsetY = threshold + 75 + (overY - 100) * 0.25;\r\n            } else if (overY > 50) {\r\n                offsetY = threshold + 50 + (overY - 50) * 0.5;\r\n            }\r\n            this.header.style.height = offsetY * 2 * 0.01 + 'rem';\r\n            coords.status = this.processLoaderStatus(PULLED_DOWN, offsetY, coords.status, true);\r\n        } else {\r\n            coords.blockY = stopY;\r\n        }\r\n\r\n        this.touchMoveTriggerTimer = setTimeout(() => {\r\n            this.handleTouchEnd();\r\n            this.touchMoveTriggerTimer = null;\r\n        }, TOUCHMOVE_CHECK_DURATION);\r\n    }\r\n\r\n    handleTouchEnd = e => {\r\n        this.touchMoveTriggerTimer && clearTimeout(this.touchMoveTriggerTimer);\r\n        this.touchMoveTriggerTimer = null;\r\n\r\n        if (!this._canTouchMove) {\r\n            return;\r\n        } else {\r\n            // e && e.stopPropagation();\r\n        }\r\n\r\n        this._canTouchMove = false;\r\n        this.doTransition();\r\n    }\r\n\r\n    checkScrollEnd = node => {\r\n        if (node.offsetHeight + node.scrollTop >= \r\n            node.scrollHeight - this.props.pullUpThreshold\r\n        ) {\r\n            !this.isPullUpDisabled && this.props.onPullUp(this.reset);\r\n        }\r\n        this.scrollCheckTimer = null;\r\n    }\r\n\r\n    handleScroll = e => {\r\n        this.scrollCheckTimer && clearTimeout(this.scrollCheckTimer);\r\n        this.scrollCheckTimer = setTimeout(\r\n            this.checkScrollEnd.bind(this, e.target), \r\n            SCROLLER_CHECK_DURATION\r\n        );\r\n    }\r\n\r\n    handleTransitionEnd = (orient, targetHeight) => {\r\n        let coords = this._touchCoords;\r\n        coords.status = this.processLoaderStatus(orient, targetHeight, coords.status, false);\r\n        if (!orient || coords.status !== STATUS_LOAD) {\r\n            this.removePullDownRegion();\r\n            this._touchCoords = null;\r\n            this._draggable = true;\r\n            this._canTouchMove = false;\r\n        }\r\n    }\r\n\r\n    doTransition = () => {\r\n        let coords = this._touchCoords;\r\n        if (!coords) return;\r\n        let orient = coords.pullDown ? PULLED_DOWN : null;\r\n        if (orient === PULLED_DOWN) {\r\n            let target = this.header;\r\n            let targetHeight = target && target.offsetHeight || 0;\r\n            let threshold = this.props.threshold;\r\n            let adjustHeight = targetHeight > threshold ? threshold : 0;\r\n\r\n            let duration = (targetHeight - adjustHeight) / \r\n                    threshold * PULL_MAX_DURATION;\r\n            duration = duration > PULL_MAX_DURATION ? PULL_MAX_DURATION : \r\n                    Math.ceil(duration);\r\n\r\n            let endHandler = () => this.handleTransitionEnd(orient, targetHeight);\r\n            listenTransition(target, duration, endHandler);\r\n\r\n            target.style[transition] = 'height ' + duration + 'ms';\r\n            setTimeout(function() {\r\n                target.style.height = adjustHeight * 2 * 0.01 + 'rem';\r\n            }, 0);\r\n        } else {\r\n            this.handleTransitionEnd(orient, 0);\r\n        }\r\n    }\r\n\r\n    reset = () => {\r\n        if (!this._hasMounted) return;\r\n        this.doTransition();\r\n    }\r\n\r\n    // disablePullDown = disabled => {\r\n    //     this.props.isPullDownDisabled = disabled;\r\n    // }\r\n\r\n    disablePullUp = disabled => {\r\n        this.isPullUpDisabled = disabled;\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n            <div ref='wrapper' id={ this.props.id } className={ this.props.wrapperClassName + ' wrapper'}\r\n                \r\n            >\r\n                <div ref='list' className={ this.props.scrollerClassName }>\r\n                    { this.props.children }\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nListView.scrollTo = (scrollTop) => {\r\n    let node = document.getElementById('listview');\r\n    if (node) {\r\n        node.scrollTop = scrollTop + 'px';\r\n    }\r\n};\r\n\r\n// export default withStyles(styles)(ListView);\r\n\r\n"]}